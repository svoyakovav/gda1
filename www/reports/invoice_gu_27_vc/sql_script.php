<?php

$sql_script_inv = "
SELECT INV.UNIQUE_NUMBER,
       INV.CF_SCD_NUMBER,
       INV.CF_SPC_DESC,
       INV.ROUTE_DESC,
       INV.CLAIM_DESC,
       INV.INV_NUMBER,
       INV.RAILWAY_NAME,
       INV.TYPENAME AS TYPE_NAME,
       INV.DISP_KIND_NAME,
       INV.DATE_EXPIRE,
       INV.SENDSPEEDNAME AS SEND_SPEED_NAME,
       INV.CARRIER_NAME,
       INV.FROMSTATIONNAME AS FROM_STATION_NAME,
       INV.FROMSTATIONCODE AS FROM_STATION_CODE,
       INV.FROMSTATION_RAILWAY_NAME AS FROM_STATION_RAILWAY_NAME,
       INV.SENDERNAME AS SENDER_NAME,
       INV.SENDEROKPO AS SENDER_OKPO,
       INV.SENDERADDRESS AS SENDER_ADDRESS,
       XX_USER.XX_PACKAGE_INVOICE_GU27VC.CF_PAYERNAME(INV.INVOICE_ID, INV.CF_IS_PAYER_FROM_DST, INV.CF_IS_PAYER_FROM_HDR) AS CF_PAYER_NAME,
       XX_USER.XX_PACKAGE_INVOICE_GU27VC.CF_PAYERCODE(INV.INVOICE_ID, INV.CF_IS_PAYER_FROM_DST, INV.CF_IS_PAYER_FROM_HDR) AS CF_PAYER_CODE,
       INV.TOSTATIONNAME AS TO_STATION_NAME,
       INV.TOSTATIONCODE AS TO_STATION_CODE,
       INV.TOSTATION_RAILWAY_NAME AS TO_STATION_RAILWAY_NAME,
       INV.TOLOADWAY AS TO_LOAD_WAY,
       INV.RECIP_NAME,
       INV.RECIP_OKPO,
       INV.RECIP_ADDRESS,
       XX_USER.XX_PACKAGE_INVOICE_GU27VC.CF_PAYER2NAME(INV.INVOICE_ID, INV.CF_IS_PAYER2_FROM_DST, INV.CF_IS_PAYER2_FROM_HDR) AS CF_PAYER_NAME_2,
       XX_USER.XX_PACKAGE_INVOICE_GU27VC.CF_PAYER2CODE(INV.INVOICE_ID, INV.CF_IS_PAYER2_FROM_DST, INV.CF_IS_PAYER2_FROM_HDR) AS CF_PAYER_CODE_2,
       TRIM(XX_USER.XX_PACKAGE_INVOICE_GU27VC.CF_FREIGHT_INFO(INV.DANGERSIGN_ID,
                                                              INV.EXACT_NAME,
                                                              INV.FREIGHT_GNG_NAME,
                                                              INV.FREIGHT_NAME,
                                                              INV.DANGER_CODE,
                                                              INV.DANGER_CODE_OON,
                                                              INV.DANGER_NAME,
                                                              INV.DF_CUSTOMTEXT,
                                                              INV.CLASS_PPOG,
                                                              INV.ACCIDENT_CARD)) AS CF_FREIGHT_INFO,
       nvl(INV.FREIGHT_GNG_CODE, INV.FREIGHT_CODE_NAME) as FREIGHT_GNG_CODE,
       INV.FREIGHT_PACKAGE_TYPE,
       INV.FREIGHT_PACKAGE_COUNT,
       NVL(INV.FREIGHT_REAL_WEIGHT, 0) AS FREIGHT_REAL_WEIGHT,
       INV.FREIGHT_ADDITIONAL,
       case when INV.FREIGHT_CODE_NAME = nvl(INV.FREIGHT_GNG_CODE, INV.FREIGHT_CODE_NAME) then null else INV.FREIGHT_CODE_NAME end as FREIGHT_CODE_NAME,
       TRIM(XX_USER.XX_PACKAGE_INVOICE_GU27VC.CF_DANGER_ADDITIONAL(INV.DANGERSIGN_ID,
                                                                   INV.IC_TYPE_ID,
                                                                   INV.TTL_WEIGHT,
                                                                   INV.FREIGHT_NAME,
                                                                   INV.DANGER_CODE,
                                                                   INV.DANGER_CODE_OON,
                                                                   INV.DANGER_NAME,
                                                                   INV.DF_CUSTOMTEXT,
                                                                   INV.CLASS_PPOG,
                                                                   INV.ACCIDENT_CARD)) AS CF_DANGER_ADDITIONAL,
       TRIM(XX_USER.XX_PACKAGE_INVOICE_GU27VC.CF_PRIOR_CODE(INV.INVOICE_ID, INV.COUNT_IC_INVOICE_CAR_ID, INV.SUM_WEIGHT_NET)) AS CF_PRIOR_CODE,
       CASE WHEN INV.COUNT_IC_INVOICE_CAR_ID > 1 THEN INV.CF_OWN_RNT_INFO ELSE NULL END AS OWN_RNT_INFO_1,
       CASE WHEN INV.COUNT_IC_INVOICE_CAR_ID = 1 THEN TRIM(INV.IC_OWN_RNT_INFO) ELSE NULL END AS OWN_RNT_INFO_2,
       INV.TTL_WEIGHT_IN_STRING,
       INV.TTL_PACKCOUNT_IN_STRING,
       INV.SCALE_PERSON_NAME,
       INV.SCALE_TYPE_NAME,
       INV.LOADASSETS_NAME AS LOAD_AS_SETS_NAME,
       CASE WHEN INV.COUNT_IC_INVOICE_CAR_ID = 1 THEN INV.CF_CSL_NAME ELSE NULL END AS CLS_NAME_1,
       CASE WHEN INV.TTL_WEIGHT > 0 /*OR :P_EN_PLC = '1'*/ -- ПОЛЬЗОВАТЕЛЬСКИЙ ПАРАМЕТР
         THEN
           XX_USER.XX_PACKAGE_INVOICE_GU27VC.CF_DEP_NOTMDOC(INV.INVOICE_ID,
                                                            INV.DEP_NORMDOC_ID,
                                                            INV.DEP_COND,
                                                            INV.DEP_NORMDOC_NAME,
                                                            INV.DEP_PART,
                                                            INV.DEP_ARC,
                                                            INV.DEP_SEC)
         ELSE NULL END AS CF_DEP_NOTMDOC,
       INV.DEPL_PERSON,
       INV.TARIF_CODE,
       XX_USER.XX_PACKAGE_INVOICE_GU27VC.CF_D_SCHEME(INV.D_SCHEME, INV.D_SCHEME_NUM_WAG) AS CF_D_SCHEME,
       INV.D_TARIF_COEF,
       INV.SENDKIND_SHORTNAME AS SENDKIND_SHORT_NAME,
       INV.D_MIN_WAY,
       INV.D_REST_TARIF_PERCENT,
       INV.IXTARIFFCODE AS IX_TARIF_CODE,
       INV.D_FREIGHT_TARIF_CLASS,
       INV.COUNT_IC_INVOICE_CAR_ID as COUNT_CAR,
       INV.IS_FILLING_EXISTS,
       INV.CF_ITOGO_STR,
       INV.SUM_CAR_AMOUNT,
	   asutl.REP_MNG.NumberToStrMoney(inv.sum_car_amount) as CF_AMOUNT_STR,
	   INV.PAYPLACENAME as PAY_PLACE_NAME,
       INV.PAYFORMNAME as PAY_FORM_NAME,
       decode(INV.CP_ECP_SENDER, null, INV.RESPPERSON, INV.CP_ECP_SENDER) as RESP_PERSON_1,
       INV.CP_GOODS_CASHIER_POST_FIO,
       case when (INV.CP_ECP_PAY is not null) then INV.CP_ECP_PAY else decode(INV.PAYFORMNAME, 'расчет на станции назначения', INV.PAYPLACENAME, null) end as CF_PLACE_PAY,
       INV.INVOICE_ID,
	   INV.DATE_READY_LOCAL,
       INV.DATE_READY,
	   INV.DATE_ARRIVE_LOCAL,
       INV.DATE_ARRIVE,
	   INV.DATE_NOTIFICATION_LOCAL,
       INV.DATE_NOTIFICATION,
	   INV.DATE_RECREDIT,
	   INV.DATE_NOTIFICATION_HH,
       INV.DATE_NOTIFICATION_MI,
	   INV.CP_FIO_ECP,
       (SELECT SUM(INVOICE_CAR.WEIGHT_NET)
     FROM ASUTL.OP031_CAR_VW INVOICE_CAR
     WHERE INVOICE_CAR.OP030_ID = '$invoice_id') AS SUM_WEIGHT_NET
FROM XX_USER.XX_INVOICE_GU27VC_VW INV
WHERE INV.INVOICE_ID = '$invoice_id'";

$sql_script_car = "
SELECT INVOICE_CAR.CAR_ORDER,
       INV_CAR_KIND.SHORT_NAME AS IC_TYPE_NAME,
       INVOICE_CAR.CAR_NUMBER || ' ' || NSI003.CODE_ADMIN AS IC_CAR_NUMBER,
       INVOICE_CAR.TONNAGE AS IC_TONNAGE,
       INVOICE_CAR.WEIGHT_NET AS IC_WEIGHT_NET,
       INVOICE_CAR.AXLES AS IC_AXLES,
       --DECODE(INVOICE_CAR.ADD_DEV_WITH_GOODS,0,INVOICE_CAR.WEIGHT_NET,1,INVOICE_CAR.WEIGHT_NET+NVL(INVOICE_CAR.WEIGHT_ADD_DEV,0)) AS IC_WEIGHT_NET,
       DECODE(NVL(INVOICE_CAR.WEIGHT_DEP_REAL,0),0,NVL(INVOICE_CAR.WEIGHT_DEP,0),NVL(INVOICE_CAR.WEIGHT_DEP_REAL,0)) * 100 AS IC_WEIGHT_TARE,
       DECODE(NVL(INVOICE_CAR.WEIGHT_DEP_REAL,0),0,DECODE(NVL(INVOICE_CAR.WEIGHT_DEP,0),0,'','с бр'),'пров') AS IC_TARE_CODE,
       INVOICE_CAR.WEIGHT_GROSS AS IC_WEIGHT_GROSS,
       INVOICE_CAR.VOLUME AS IC_VOLUME,
       INVOICE_CAR.FRAME_WEIGHT AS IC_FRAME_WEIGHT,
       SUBSTR (INVOICE_CAR.OWNER_TYPE_NAME, 1, 6) AS IC_OWNER_TYPE_NAME,
       INVOICE_CAR.ROLLS AS IC_ROLLS,
       INVOICE_CAR.OUTSIZE_CODE AS IC_OUTSIZE_CODE,
       INVOICE_CAR.LIQUID_TEMPERATURE AS IC_LIQUID_TEMPERATURE,
       INVOICE_CAR.LIQUID_HEIGHT AS IC_LIQUID_HEIGHT,
       INVOICE_CAR.LIQUID_DENSITY AS IC_LIQUID_DENSITY,
       INVOICE_CAR.LIQUID_VOLUME AS IC_LIQUID_VOLUME,
       INVOICE_CAR.TANKTYPE AS IC_TANKTYPE,
       (SELECT SUM(AMOUNT) FROM ASUTL.OP040_DUE_VW OP040 WHERE OP040.OP030_ID = INVOICE_CAR.OP030_ID  AND OP040.CAR_NUMBER = INVOICE_CAR.CAR_NUMBER) AS IC_CAR_AMOUNT,
       (SELECT COUNT(*) FROM ASUTL.OP033_CAR_GUIDE_VW OP033 WHERE OP033.OP031_ID = INVOICE_CAR.ID) AS IC_CAR_CNT_GUIDE
FROM ASUTL.OP031_CAR_VW INVOICE_CAR
LEFT JOIN ASUTL.NSI003_COUNTRY NSI003 ON INVOICE_CAR.NSI003_OWNERCOUNTRY_ID = NSI003.ID
LEFT JOIN ASUTL.NSI107_CAR_KIND INV_CAR_KIND ON INVOICE_CAR.NSI107_TYPE_ID = INV_CAR_KIND.ID
WHERE INVOICE_CAR.OP030_ID = :invoice_id
ORDER BY INVOICE_CAR.CAR_ORDER";

?>